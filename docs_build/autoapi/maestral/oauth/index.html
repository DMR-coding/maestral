

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>maestral.oauth &mdash; Maestral 1.3.0.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  <link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="maestral.sync" href="../sync/index.html" />
    <link rel="prev" title="maestral.main" href="../main/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Maestral
          

          
            
            <img src="../../../_static/maestral.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.3.0.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../config_files.html">Config files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../state_files.html">State files</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#subpackages">Subpackages</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../cli/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.cli</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../client/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.client</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../constants/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.constants</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../daemon/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.daemon</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../errors/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.errors</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../main/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.main</span></code></a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.oauth</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-contents">Module Contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../sync/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.sync</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Maestral</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral</span></code></a> &raquo;</li>
        
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.oauth</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/autoapi/maestral/oauth/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-maestral.oauth">
<span id="maestral-oauth"></span><h1><a class="reference internal" href="#module-maestral.oauth" title="maestral.oauth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">maestral.oauth</span></code></a><a class="headerlink" href="#module-maestral.oauth" title="Permalink to this headline">¶</a></h1>
<p>This module is responsible for authorization and token store in the system keyring.</p>
<div class="section" id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline">¶</a></h2>
<div class="section" id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#maestral.oauth.OAuth2Session" title="maestral.oauth.OAuth2Session"><code class="xref py py-obj docutils literal notranslate"><span class="pre">OAuth2Session</span></code></a></p></td>
<td><p>OAuth2Session provides OAuth 2 login and token store in the preferred system keyring.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt id="maestral.oauth.OAuth2Session">
<em class="property">class </em><code class="sig-prename descclassname">maestral.oauth.</code><code class="sig-name descname">OAuth2Session</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config_name</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">app_key</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">DROPBOX_APP_KEY</span></em><span class="sig-paren">)</span><a class="headerlink" href="#maestral.oauth.OAuth2Session" title="Permalink to this definition">¶</a></dt>
<dd><p>OAuth2Session provides OAuth 2 login and token store in the preferred system keyring.
To authenticate with Dropbox, run <a class="reference internal" href="#maestral.oauth.OAuth2Session.get_auth_url" title="maestral.oauth.OAuth2Session.get_auth_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_auth_url()</span></code></a> first and direct the user to
visit that URL and retrieve an auth token. Verify the provided auth token with
<a class="reference internal" href="#maestral.oauth.OAuth2Session.verify_auth_token" title="maestral.oauth.OAuth2Session.verify_auth_token"><code class="xref py py-meth docutils literal notranslate"><span class="pre">verify_auth_token()</span></code></a> and save it in the system keyring together with the
corresponding Dropbox ID by calling <a class="reference internal" href="#maestral.oauth.OAuth2Session.save_creds" title="maestral.oauth.OAuth2Session.save_creds"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_creds()</span></code></a>. Supported keyring backends
are, in order of preference:</p>
<blockquote>
<div><ul class="simple">
<li><p>MacOS Keychain</p></li>
<li><p>Any keyring implementing the SecretService Dbus specification</p></li>
<li><p>KWallet</p></li>
<li><p>Gnome Keyring</p></li>
<li><p>Plain text storage</p></li>
</ul>
</div></blockquote>
<p>When the auth flow is completed, a short-lived access token and a long-lived refresh
token are generated. Only the long-lived refresh token will be saved in the system
keychain for future sessions, it can be used to generate short-lived access tokens
as needed.</p>
<p>If the auth flow was previously completed before Dropbox migrated to short-lived
tokens, the <code class="docutils literal notranslate"><span class="pre">token_access_type</span></code> will be ‘legacy’ and only a long-lived access
token will be available.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Unlike MacOS Keychain, Gnome Keyring and KWallet do not support
app-specific access to passwords. If the user unlocks those keyrings, we and any
other application in the same user session get access to <em>all</em> saved passwords.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config_name</strong> – Name of maestral config.</p>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>Success</strong> (<em>int</em>) – Exit code for successful auth.</p></li>
<li><p><strong>InvalidToken</strong> (<em>int</em>) – Exit code for invalid token.</p></li>
<li><p><strong>ConnectionFailed</strong> (<em>int</em>) – Exit code for connection errors.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.linked">
<em class="property">property </em><code class="sig-name descname">linked</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#maestral.oauth.OAuth2Session.linked" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if we have full auth credentials, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.account_id">
<em class="property">property </em><code class="sig-name descname">account_id</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>str<span class="p">]</span><a class="headerlink" href="#maestral.oauth.OAuth2Session.account_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the account ID (read only). This call may block until the keyring is
unlocked.</p>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.token_access_type">
<em class="property">property </em><code class="sig-name descname">token_access_type</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>str<span class="p">]</span><a class="headerlink" href="#maestral.oauth.OAuth2Session.token_access_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the type of access token. If ‘legacy’, we have a long-lived access
token. If ‘offline’, we have a short-lived access token with an expiry time and
a long-lived refresh token to generate new access tokens.</p>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.access_token">
<em class="property">property </em><code class="sig-name descname">access_token</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>str<span class="p">]</span><a class="headerlink" href="#maestral.oauth.OAuth2Session.access_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the access token (read only). This will always be set for a ‘legacy’
token. For an ‘offline’ token, this will only be set if we completed the auth
flow in the current session. In case of an ‘offline’ token, use the refresh
token to retrieve a short-lived access token through the Dropbox API instead.
The call may block until the keyring is unlocked.</p>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.refresh_token">
<em class="property">property </em><code class="sig-name descname">refresh_token</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>str<span class="p">]</span><a class="headerlink" href="#maestral.oauth.OAuth2Session.refresh_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the refresh token (read only). This will only be set for an ‘offline’
token. The call may block until the keyring is unlocked.</p>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.access_token_expiration">
<em class="property">property </em><code class="sig-name descname">access_token_expiration</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>datetime<span class="p">]</span><a class="headerlink" href="#maestral.oauth.OAuth2Session.access_token_expiration" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the expiry time for the short-lived access token. This will only be
set for an ‘offline’ token and if we completed the flow during the current
session.</p>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.load_token">
<code class="sig-name descname">load_token</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#maestral.oauth.OAuth2Session.load_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads auth token from system keyring. This will be called automatically when
accessing of the properties <a class="reference internal" href="#maestral.oauth.OAuth2Session.linked" title="maestral.oauth.OAuth2Session.linked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">linked</span></code></a>, <a class="reference internal" href="#maestral.oauth.OAuth2Session.access_token" title="maestral.oauth.OAuth2Session.access_token"><code class="xref py py-attr docutils literal notranslate"><span class="pre">access_token</span></code></a>,
<a class="reference internal" href="#maestral.oauth.OAuth2Session.refresh_token" title="maestral.oauth.OAuth2Session.refresh_token"><code class="xref py py-attr docutils literal notranslate"><span class="pre">refresh_token</span></code></a> or <a class="reference internal" href="#maestral.oauth.OAuth2Session.token_access_type" title="maestral.oauth.OAuth2Session.token_access_type"><code class="xref py py-attr docutils literal notranslate"><span class="pre">token_access_type</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">keyring.errors.KeyringLocked</span></code> if the system keyring is locked.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.get_auth_url">
<code class="sig-name descname">get_auth_url</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#maestral.oauth.OAuth2Session.get_auth_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the auth URL to start the OAuth2 implicit grant flow.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Dropbox auth URL.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.verify_auth_token">
<code class="sig-name descname">verify_auth_token</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">token</span></em><span class="sig-paren">)</span> &#x2192; int<a class="headerlink" href="#maestral.oauth.OAuth2Session.verify_auth_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the provided authorization token with Dropbox servers.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">Success</span></code>, <code class="xref py py-attr docutils literal notranslate"><span class="pre">InvalidToken</span></code>, or <code class="xref py py-attr docutils literal notranslate"><span class="pre">ConnectionFailed</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.save_creds">
<code class="sig-name descname">save_creds</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#maestral.oauth.OAuth2Session.save_creds" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves the auth token to system keyring. Falls back to plain text storage if the
user denies access to keyring.</p>
</dd></dl>

<dl class="py method">
<dt id="maestral.oauth.OAuth2Session.delete_creds">
<code class="sig-name descname">delete_creds</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#maestral.oauth.OAuth2Session.delete_creds" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes auth token from system keyring.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">keyring.errors.KeyringLocked</span></code> if the system keyring is locked.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../sync/index.html" class="btn btn-neutral float-right" title="maestral.sync" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../main/index.html" class="btn btn-neutral float-left" title="maestral.main" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Sam Schott

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>